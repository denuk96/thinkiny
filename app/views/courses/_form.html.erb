<%= form_with(model: @course, local: true) do |form| %>
  <% if @course.errors.any? %>
    <div class="alert alert-danger">
      <ul>
        <% @course.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field mt-5">
    <%= form.label :name %>
    <%= form.text_field :name, class: "form-control"%>
  </div>

  <div class="field mt-5">
    <%= form.label :description %>
    <%= form.text_area :description, class: "form-control"%>
  </div>

  <div class="field mt-5">
    <%= form.label :category %>
    <%= form.collection_check_boxes :category_ids, Category.all, :id, :title, class:'form-control' %>
  </div>

  <div class="field mt-5">
    <%= form.label :type %>
    <%= form.select :type, Course::COURSE_TYPES, prompt: '--Choose type--' %>
  </div>

  <div class="field mt-5">
    <%= form.label :place_quantities %>
    <%= form.text_field :place_quantities, class: "form-control"%>
  </div>

  <div class="field mt-5">
    Pre-moderation
    <br>

    <%= form.radio_button(:pre_moderation, "true") %>
    <%= form.label(:pre_moderation, "On") %>

    <%= form.radio_button(:pre_moderation, "false") %>
    <%= form.label(:pre_moderation, "off") %>
  </div>

  <div class="field mt-5">
    <%= form.label :attendance_rate %>
    <%= form.text_field :attendance_rate, class: "form-control"%>
  </div>

  <div class="field mt-5">
    <%= form.file_field :pictures, multiple: true %>
  </div>

  <br>

  <div class="field mt-5">
  <%= form.label :address %>
  <%= form.text_field :address, class: "form-control address", id: "address"%>
  </div>

  <br>

  <%= form.hidden_field :latitude, class: "form-control"%>
  <%= form.hidden_field :longitude, class: "form-control"%>

  <div id="map2"></div>

  <br>
  <div class="ml-auto mt-2">
    <%= form.submit 'Submit', class: "btn btn-outline-dark" %>
  </div>
<% end %>

<!--map goes here-->

<% provide :head_tags do %>
  <meta name='turbolinks-visit-control' content='reload'>
<% end %>

<script>
  var lat = document.getElementById('course_latitude').value;
  var lng = document.getElementById('course_longitude').value;
  if (!lat || !lng){
    lat=<%= request.location.latitude.nil? ? 51.5 : request.location.latitude %>;
    lng=<%= request.location.longitude.nil? ? -0.125 : request.location.longitude %>;
    document.getElementById('course_latitude').value = lat;
    document.getElementById('course_longitude').value = lng;
}
  $("#address").geocomplete({
    map: "#map2",
    mapOptions: {
      zoom: 10
    },
    markerOptions: {
      draggable: false
    },
    location: [lat, lng]
  });
</script>
<script>
    $("#address").geocomplete({
        map: "#map2"
    });
</script>
