<div class="calendar">
  <div id='calendar'></div>
</div>
<script>
      document.addEventListener('DOMContentLoaded', function() {
            var eventsBackground;
            var course_id = "<%= @course.id %>";
            $.ajax({
                type: "GET",    //WebMethods will not allow GET
                url: "/courses/" + course_id + "/lessons",
                //completely take out 'data:' line if you don't want to pass to webmethod - Important to also change webmethod to not accept any parameters
                contentType: "application/json; charset=utf-8",
                async: false,
                dataType: "json",
                success: function (resp) {
                    eventsBackground = resp;
                }
            });

            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: [ dayGridPlugin, interactionPlugin, timeGridPlugin, listPlugin, bootstrapPlugin, timelinePlugin ],
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth, dayGridDay' // dayGridMonth, dayGridWeek, dayGridDay, dayGrid, timeGridWeek, timeGridDay, timeGrid
                },
                defaultView: 'dayGridMonth', // dayGridMonth, dayGridWeek, dayGridDay, dayGrid, timeGridWeek, timeGridDay, timeGrid

                navLinks: true, // can click day/week names to navigate views
                editable: false,
                eventLimit: true, // allow "more" link when too many events
                eventClick: function(info) {
                    info.jsEvent.preventDefault(); // don't let the browser navigate

                    if (info.event.url) {
                        window.open(info.event.url);
                    }
                    if (event.url) {
                        window.open(event.url, "_blank");
                        return false;
                    }
                },

                events: eventsBackground,

                eventRender: function(info) {
                    if (info.event.extendedProps.status === false) {

                        // Change background color of row
                        info.el.style.backgroundColor = 'red';

                        // Change color of dot marker
                        var dotEl = info.el.getElementsByClassName('fc-event-dot')[0];
                        if (dotEl) {
                            dotEl.style.backgroundColor = 'white';
                        }
                    }
                },
                eventClick: function(info) {
                    $("#close_modal").click();

                    var lesson_id = info.event.extendedProps.id;

                    setTimeout(() => {
                          $("#"+lesson_id).click();
                          $('html, body').animate({
                              scrollTop: $("#lesson__header").offset().top
                          }, 500 )
                        }, 500);
                },
                <% if verify_instructor(@course, current_user) %>
                  dateClick: function(info) {
                      $("#close_modal").click();
                      setTimeout(() => {
                          $("#add_lesson_modal").click();
                      }, 500);
                      setTimeout(() => {
                          document.getElementById('lesson_time').value = info.dateStr + 'T00:00';
                      }, 1000);
                  }
                <% end %>
            });
        setTimeout(() => {  calendar.render(); }, 1000);
      });
  </script>